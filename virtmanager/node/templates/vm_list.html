<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>vmlist</title>

    <!-- Bootstrap -->
    <link href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
{% include "header.html" %}


<div class="panel panel-default">
    <!-- Default panel contents -->
    <div class="panel-heading"><h3>虚机列表</h3></div>
    <div class="panel-body">
        <table class="table table-bordered table-hover">
            <thead>
            <tr>
                <th>虚机ID</th>
                <th>公网IP</th>
                <th>内网IP</th>
                <th>物理机IP</th>
                <th>状态</th>
                <th>备注</th>
                <th>action</th>
            </tr>
            </thead>
            <tbody>
            {% for info in vm_info %}
            <tr>
                <td>{{ info.vm_id }}</td>
                <td>{{ info.ext_ip }}</td>
                <td>{{ info.int_ip }}</td>
                <td>{{ info.host_machine.host_ip }}</td>
                <td>{{ info.vm_status }}</td>
                <td>{{ info.description }}</td>
                <td>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default start_btn" value="{{ info.id }}" >start</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-danger shutdown_btn" value="{{ info.id }}">shutdown</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-info reboot_btn " value="{{ info.id }}">reboot</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-warning suspend_btn" value="{{ info.id }}">suspend</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-success resume_btn" value="{{ info.id }}">resume</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <!--<div class="panel-footer"></div>-->

</div>


<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="/static/bootstrap-3.3.7-dist/js/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="/static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script>
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                // Only send the token to relative URLs i.e. locally.
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        }
    });
</script>


<script>
    $(".start_btn").click(function(e) {
        // e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/start-vm/",
            data: {
                id: $(this).val(), // < note use of 'this' here
                // access_token: $("#access_token").val()
            },
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert('error');
            }
        });
    });
</script>
<script>
    $(".reboot_btn").click(function(e) {
        // e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/reboot-vm/",
            data: {
                id: $(this).val(), // < note use of 'this' here
                // access_token: $("#access_token").val()
            },
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert('error');
            }
        });
    });
</script>
<script>
    $(".shutdown_btn").click(function(e) {
        // e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/shutdown-vm/",
            data: {
                id: $(this).val(), // < note use of 'this' here
                // access_token: $("#access_token").val()
            },
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert('error');
            }
        });
    });
</script>
<script>
    $(".suspend_btn").click(function(e) {
        // e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/suspend-vm/",
            data: {
                id: $(this).val(), // < note use of 'this' here
                // access_token: $("#access_token").val()
            },
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert('error');
            }
        });
    });
</script>
<script>
    $(".resume_btn").click(function(e) {
        // e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/resume-vm/",
            data: {
                id: $(this).val(), // < note use of 'this' here
                // access_token: $("#access_token").val()
            },
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert('error');
            }
        });
    });
</script>


</body>
</html>
